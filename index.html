<html>
    <head>
        <title>
            DRUM MACHINE
        </title>

        <link rel="stylesheet" href="fake-grid.css">
        <link rel="stylesheet" href="drum.css">
        <script src="instruments.js"></script>
        <script src="drum.js"></script>
        <script src="drumConfig.js"></script>
        <script src="utils.js"></script>
    </head>

    <body>
        <div id="main-container">    
            <div class="row">
                <div class="col-12">
                    <h2 class="drum-header">TR-808.5</h2>
                </div>
            </div>

            <div class="row">
                
                
                <div class="col-2 flex-col justify-content-center align-content-center">
                    <div class="flex-col justify-content-end align-content-center">
                        <span>INSTRUMENT SELECT</span> 
                        <span id="temp"></span> <!--ADDED THIS HERE SO I CAN SEE THE INSTRUMENT SELECTED -->
                        <input id="instrument-select" type="range" min="1" max="11" value="1" step="1">
                    </div>
                </div>

                <div class="col-10 row align-content-end">
                    <div class="row col-12">

                        <div class="col-1 flex-col justify-content-end align-content-center">
                        </div>

                        <div class="col-1 flex-col justify-content-end align-content-center">
                            <span>LEVEL</span>
                            <input id="BD-level" class="w-90" type="range" min="0" max="10" value="5" step="1">

                            <span>PITCH</span>
                            <input id="BD-pitch" class="w-90" type="range" min="0" max="10" value="5" step="1">
                        </div>

                        <div class="col-1 flex-col justify-content-end align-content-center">
                            <span>LEVEL</span>
                            <input id="SD-level" class="w-90" type="range" min="0" max="10" value="5" step="1">

                            <span>PITCH</span>
                            <input id="SD-pitch" class="w-90" type="range" min="0" max="10" value="5" step="1">
                        </div>

                        <div class="col-1 flex-col justify-content-end align-content-center">
                            <span>LEVEL</span>
                            <input id="LC-level" class="w-90" type="range" min="0" max="10" value="5" step="1">

                            <span>PITCH</span>
                            <input id="LC-pitch" class="w-90" type="range" min="0" max="10" value="5" step="1">
                        </div>

                        <div class="col-1 flex-col justify-content-end align-content-center">
                            <span>LEVEL</span>
                            <input id="MC-level" class="w-90" type="range" min="0" max="10" value="5" step="1">

                            <span>PITCH</span>
                            <input id="MC-pitch" class="w-90" type="range" min="0" max="10" value="5" step="1">
                        </div>

                        <div class="col-1 flex-col justify-content-end align-content-center">
                            <span>LEVEL</span>
                            <input id="HC-level" class="w-90" type="range" min="0" max="10" value="5" step="1">

                            <span>PITCH</span>
                            <input id="HC-pitch" class="w-90" type="range" min="0" max="10" value="5" step="1">
                        </div>

                        <div class="col-1 flex-col justify-content-end align-content-center">
                            <span>LEVEL</span>
                            <input id="CL-level" class="w-90" type="range" min="0" max="10" value="5" step="1">

                            <span>PITCH</span>
                            <input id="CL-pitch" class="w-90" type="range" min="0" max="10" value="5" step="1">
                        </div>

                        <div class="col-1 flex-col justify-content-end align-content-center">
                            <span>LEVEL</span>
                            <input id="MA-level" class="w-90" type="range" min="0" max="10" value="5" step="1">

                            <span>PITCH</span>
                            <input id="MA-pitch" class="w-90" type="range" min="0" max="10" value="5" step="1">
                        </div>

                        <div class="col-1 flex-col justify-content-end align-content-center">
                            <span>LEVEL</span>
                            <input id="CB-level" class="w-90" type="range" min="0" max="10" value="5" step="1">

                            <span>PITCH</span>
                            <input id="CB-pitch" class="w-90" type="range" min="0" max="10" value="5" step="1">
                        </div>

                        <div class="col-1 flex-col justify-content-end align-content-center">
                            <span>LEVEL</span>
                            <input id="CY-level" class="w-90" type="range" min="0" max="10" value="5" step="1">

                            <span>PITCH</span>
                            <input id="CY-pitch" class="w-90" type="range" min="0" max="10" value="5" step="1">
                        </div>

                        <div class="col-1 flex-col justify-content-end align-content-center">
                            <span>LEVEL</span>
                            <input id="OH-level" class="w-90" type="range" min="0" max="10" value="5" step="1">

                            <span>PITCH</span>
                            <input id="OH-pitch" class="w-90" type="range" min="0" max="10" value="5" step="1">
                        </div>

                        <div class="col-1 flex-col justify-content-end align-content-center">
                            <span>LEVEL</span>
                            <input id="CH-level" class="w-90" type="range" min="0" max="10" value="5" step="1">

                            <span>PITCH</span>
                            <input id="CH-pitch" class="w-90" type="range" min="0" max="10" value="5" step="1">
                        </div>
                    </div>

                    <div class="row col-12">

                        <div class="col-1 flex-col justify-content-end align-content-center">
                        </div>

                        <div class="col-1 flex-col justify-content-end align-content-center">

                            <div class="flex-col justify-content-end align-content-center">
                                <span>TONE</span>
                                <input id="BD-tone" class="w-90" type="range" min="0" max="10" value="0" step="2.5">
                            </div>
                            
                            <div class="flex-col justify-content-end align-content-center">
                                <span>DECAY</span>
                                <input id="BD-decay" class="w-90" type="range" min="0" max="10" value="0" step="2.5">
                            </div>

                            <span><b>B</b>ass<b>D</b>rum</span>
                        </div>

                        <div class="col-1 flex-col justify-content-end align-content-center">

                            <div class="flex-col justify-content-end align-content-center">
                                <span>TONE</span>
                                <input id="SD-tone" class="w-90" type="range" min="0" max="10" value="0" step="2.5">
                            </div>
                            
                            <div class="flex-col justify-content-end align-content-center">
                                <span>SNAPPY</span>
                                <input id="SD-snappy" class="w-90" type="range" min="0" max="10" value="0" step="2.5">
                            </div>

                            <span><b>S</b>nare<b>D</b>rum</span>
                        </div>

                        <div class="col-1 flex-col justify-content-end align-content-center">

                            <div class="flex-col justify-content-end align-content-center">
                                <span>TUNING</span>
                                <input id="LC-tuning" class="w-90" type="range" min="0" max="10" value="0" step="2.5">
                            </div>

                            <span><b>L</b>ow<b>C</b>onga</span>
                            <input type="checkbox" id="LT-checkbox" class="instrument-checkbox" data-instrument-index="3">
                            <span><b>L</b>ow<b>T</b>om</span>
                        </div>
                        <div class="col-1 flex-col justify-content-end align-content-center">

                            <div class="flex-col justify-content-end align-content-center">
                                <span>TUNING</span>
                                <input id="MC-tuning" class="w-90" type="range" min="0" max="10" value="0" step="2.5">
                            </div>

                            <span><b>M</b>id<b>C</b>onga</span>
                            <input type="checkbox" id="MC-checkbox" class="instrument-checkbox" data-instrument-index="4">
                            <span><b>M</b>id<b>T</b>om</span>
                        </div>
                        <div class="col-1 flex-col justify-content-end align-content-center">

                            <div class="flex-col justify-content-end align-content-center">
                                <span>TUNING</span>
                                <input id="HC-tuning" class="w-90" type="range" min="0" max="10" value="0" step="2.5">
                            </div>

                            <span><b>H</b>i<b>C</b>onga</span>
                            <input type="checkbox" id="HT-checkbox" class="instrument-checkbox" data-instrument-index="5">
                            <span><b>H</b>i<b>T</b>om</span>
                        </div>
                        <div class="col-1 flex-col justify-content-end align-content-center">
                            <span><b>CL</b>aves</span>
                            <input type="checkbox" id="RS-checkbox" class="instrument-checkbox" data-instrument-index="6">
                            <span><b>R</b>im<b>S</b>hot</span>
                        </div>
                        <div class="col-1 flex-col justify-content-end align-content-center">
                            <span><b>MA</b>racas</span>
                            <input type="checkbox" id="CP-checkbox" class="instrument-checkbox" data-instrument-index="7">
                            <span>Hand<b>C</b>la<b>p</b></span>
                        </div>
                        <div class="col-1 flex-col justify-content-end align-content-center">
                            <span><b>C</b>ow<b>B</b>all</span>
                        </div>
                        <div class="col-1 flex-col justify-content-end align-content-center">
                            <div class="flex-col justify-content-end align-content-center">
                                <span>TONE</span>
                                <input id="CY-tone" class="w-90" type="range" min="0" max="10" value="0" step="2.5">
                            </div>
                            
                            <div class="flex-col justify-content-end align-content-center">
                                <span>DECAY</span>
                                <input id="CY-decay" class="w-90" type="range" min="0" max="10" value="0" step="2.5">
                            </div>
                            
                            <span><b>CY</b>mball</span>
                        </div>
                        <div class="col-1 flex-col justify-content-end align-content-center">
                            <div class="flex-col justify-content-end align-content-center">
                                <span>DECAY</span>
                                <input id="OH-decay" class="w-90" type="range" min="0" max="10" value="0" step="2.5">
                            </div>

                            <span><b>O</b>pen<b>H</b>ihat</span>
                        </div>
                        <div class="col-1 flex-col justify-content-end align-content-center">
                            <span><b>C</b>losed<b>H</b>ihat</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row justify-content-center col-12">       
                        
                <div class="col-7 drum-header flex-col align-content-center" >
                    <h2>TR-808.5 2022 DRUM MACHINE</h2>
                </div>

                <div class="col-2 flex-col align-content-center justify-content-center">
                    <span>TEMPO</span>
                    <input id="tempo1" type="range" min="1" max="10" value="1" step="0.2">
                </div>

                <div class="col-1 flex-col align-content-center justify-content-center">
                    <span>FINE</span>
                    <input id="tempo2" type="range" min="0" max="9" value="1" step="1">
                </div>

                <div class="col-2 flex-col align-content-center justify-content-center">
                    <span>MASTER VOLUME</span>
                    <input id="master-volume" type="range" min="0" max="10" value="5" step="1">
                </div>
            </div>

            <div class="row col-12">
                <div class="col-2 flex-col align-content-center">
                    <div class="flex-col align-content-center">
                        <span>VARIATION</span>
                        <input id="variation-input" class="w-100" type="range" min="1" max="3" value="1" step="1">
                    </div>
                    
                    <div class="row flex-col">
                        <div class="row justify-content-center">
                            <label for="a-checkbox">A </label>
                            <label> AB </label>
                            <label for id="b-checkbox">B</label>
                        </div>

                        <div class="row justify-content-center">
                            <input type="checkbox" id="subbeat-checkbox-A" class="subbeat" disabled>
                            <input type="checkbox" id="subbeat-checkbox-B" class="subbeat" disabled>
                        </div>
                    </div>
                </div>

                <div class="col-10 row">
                    <div class="col-2 flex-col align-content-end">
                        <span>PRE-SCALE</span>
                        <input id="pre-scale" orient="vertical" type="range" min="0" max="3" value="1" step="1">
                    </div>

                    <div class="col-9 flex-col justify-content-end"> 
                        <div class="mx-1">
                            <div class="row col-12 gray"> 3/16 PER BEAT</div>
                            <div class="row col-12 gray"> 6/16 PER BEAT</div>
                            <div class="row col-12 gray"> 4/16 PER BEAT</div>
                            <div class="row col-12 gray"> 8/16 PER BEAT</div>
                        </div>
                        
                    </div>

                </div>
                
            </div>

            <div class="row col-12">
                <div class="col-2 flex-col justify-content-center align-content-center my-1">
                    <button class="btn" id="start-button">START/STOP</button>
                    <br>
                    <button class="btn" id="reset-button">RESET</button>
                </div>


                <div class="col-10 row my-1">
                    <div class="col-8 row">
                        <div class="col-1">
                            <button class="rhythm-button rhythm-button-orangered ">
                                <input type="checkbox" class="rhythm-checkbox" data-position="0">
                                1
                            </button>
                        </div>
                        <div class="col-1">
                            <button class="rhythm-button rhythm-button-orangered ">
                                <input type="checkbox" class="rhythm-checkbox" data-position="1">
                                2
                            </button>
                        </div>
                        <div class="col-1">
                            <button class="rhythm-button rhythm-button-orangered ">
                                <input type="checkbox" class="rhythm-checkbox" data-position="2">
                                3
                            </button>
                        </div>
                        <div class="col-1">
                            <button class="rhythm-button rhythm-button-orangered " >
                                <input type="checkbox" class="rhythm-checkbox" data-position="3">
                                4
                            </button>
                        </div>
                        <div class="col-1">
                            <button class="rhythm-button rhythm-button-orange ">
                                <input type="checkbox" class="rhythm-checkbox" data-position="4">
                                5
                            </button>
                        </div>
                        <div class="col-1">
                            <button class="rhythm-button rhythm-button-orange ">
                                <input type="checkbox" class="rhythm-checkbox" data-position="5">
                                6
                            </button>
                        </div>
                        <div class="col-1">
                            <button class="rhythm-button rhythm-button-orange ">
                                <input type="checkbox" class="rhythm-checkbox" data-position="6">
                                7
                            </button>
                        </div>
                        <div class="col-1">
                            <button class="rhythm-button rhythm-button-orange ">
                                <input type="checkbox" class="rhythm-checkbox" data-position="7">
                                8
                            </button>
                        </div>
                        <div class="col-1">
                            <button class="rhythm-button rhythm-button-yellow ">
                                <input type="checkbox" class="rhythm-checkbox" data-position="8">
                                9
                            </button>
                        </div>
                        <div class="col-1">
                            <button class="rhythm-button rhythm-button-yellow 0">
                                <input type="checkbox" class="rhythm-checkbox" data-position="9">
                                10
                            </button>
                        </div>
                        <div class="col-1">
                            <button class="rhythm-button rhythm-button-yellow 1">
                                <input type="checkbox" class="rhythm-checkbox" data-position="10">
                                11
                            </button>
                        </div>
                        <div class="col-1">
                            <button class="rhythm-button rhythm-button-yellow 2">
                                <input type="checkbox" class="rhythm-checkbox" data-position="11">
                                12
                            </button>
                        </div>
                    </div>                        

                    <div class="col-3 row">
                        <div class="col-3">
                            <button class="rhythm-button rhythm-button-white 3">
                                <input type="checkbox" class="rhythm-checkbox" data-position="12">
                                13
                            </button>
                        </div>
                        <div class="col-3">
                            <button class="rhythm-button rhythm-button-white 4">
                                <input type="checkbox" class="rhythm-checkbox" data-position="13">
                                14
                            </button>
                        </div>
                        <div class="col-3">
                            <button class="rhythm-button rhythm-button-white 5">
                                <input type="checkbox" class="rhythm-checkbox" data-position="14">
                                15
                            </button>
                        </div>
                        <div class="col-3">
                            <button class="rhythm-button rhythm-button-white 6">
                                <input type="checkbox" class="rhythm-checkbox" data-position="15">
                                16
                            </button>
                        </div>
                    </div>
                    <div class="col-1 flex-col justify-content-center align-content-center">
                        <button class="btn" id="tap-button">TAP</button>
                    </div>
                </div>
            </div>

        </div>
        
        <script>
            const drumAudioContext = new (window.AudioContext || window.webkitAudioContext)();

            //EVENT LISTENERS
            //MANY EVENT LISTENERS
            document.getElementById("start-button").addEventListener("click", toggleDrum) //starting drum

            for (let btn of document.querySelectorAll(".rhythm-button")){ //toggling checboxes
                btn.addEventListener("click", function(){
                    (MACHINE.hasStarted)
                    ? toggleCheckboxByButton(this)
                    : event.preventDefault()
                })
            }

            for (let cb of document.querySelectorAll(".rhythm-checkbox")){ //toggling checboxes
                cb.addEventListener("click", function(){
                    (MACHINE.hasStarted)
                    ? rhythmCheckboxOnClick(this)
                    : event.preventDefault()
                })
            }

            for (let cb of document.querySelectorAll(".instrument-checkbox")){ //toggling checboxes
                cb.addEventListener("change", function(){
                    if (INSTRUMENT_CONTROLLER.currentInstrumentIndex === Number(this.getAttribute("data-instrument-index"))
                        || INSTRUMENT_CONTROLLER.currentInstrumentIndex === Number(this.getAttribute("data-instrument-index")) + 9){
                            
                        (this.checked)
                        ? INSTRUMENT_CONTROLLER.setCurrentInstrument( INSTRUMENT_CONTROLLER.currentInstrumentIndex + 9) //TODO
                        : INSTRUMENT_CONTROLLER.setCurrentInstrument( INSTRUMENT_CONTROLLER.currentInstrumentIndex - 9); //TODO

                        rhythmCheckboxesOnInstrumentChange(INSTRUMENT_CONTROLLER.currentInstrumentIndex);
                    }
                })
            }

            document.getElementById("tap-button").addEventListener("click", function(){ //tap buttons selects the current 16th and add the current instrument
                if (MACHINE.hasStarted){
                    rhythmCheckboxOnClick(document.querySelectorAll(".rhythm-checkbox")[MACHINE.currentButtonIndex])
                    playButtonSound(MACHINE.currentButtonIndex)
                }                 
                else
                    event.preventDefault()
            })

            document.getElementById("reset-button").addEventListener("click", function(){
                if (window.confirm("You are about to reset the machine \nYou will lose any data?")){
                    reset();
                    setUpMachine();
                }
                    
            })

            document.getElementById("tempo1").addEventListener("change", function(){ //set tempo
                let newTempo = Number(this.value)
                let fine = Number(document.getElementById("tempo2").value) * 0.1;
                MACHINE.setTempo(newTempo + fine);
            })

            document.getElementById("tempo2").addEventListener("change", function(){
                let tempo = Number(document.getElementById("tempo1").value)
                let newFine = Number(this.value) * 0.1;
                MACHINE.setTempo(tempo + newFine);
            })

            document.getElementById("pre-scale").addEventListener("change", function(){
                MACHINE.setPartsPerBeat(Number(this.value))                
                let tempo = Number(document.getElementById("tempo1").value);
                let fine = Number(document.getElementById("tempo2").value) * 0.1;
                MACHINE.setTempo(tempo + fine)
            })

            document.getElementById("master-volume").addEventListener("change", function(){ //set master volume
                MACHINE.setMasterVolume(Number(this.value));
            })
            
            document.getElementById("variation-input").addEventListener("change", function(){ //set variation
                MACHINE.setBasicVariation(Number(this.value));
            })

            document.getElementById("instrument-select").addEventListener("change", function(){ //set variation
                
                let checkboxID = `${INSTRUMENT_CONTROLLER.getInstrumentFromIndex(Number(this.value) + 9)?.name}-checkbox`;
                
                (document.getElementById(checkboxID)?.checked)
                ? INSTRUMENT_CONTROLLER.setCurrentInstrument(Number(this.value) + 9) //TODO
                : INSTRUMENT_CONTROLLER.setCurrentInstrument(Number(this.value))

                document.getElementById("temp").textContent = INSTRUMENT_CONTROLLER.getCurrentInstrument().name;
                rhythmCheckboxesOnInstrumentChange(this.value);
                    
            })
            
            function setUpMachine(){
                document.getElementById("tempo1").value = Math.floor(MACHINE.tempoToInputValue());
                document.getElementById("tempo2").value = (MACHINE.tempoToInputValue() % 1) * 10;
                document.getElementById("master-volume").value = MACHINE.masterVolumeToInputValue();
                document.getElementById("variation-input").value = MACHINE.basicVariationToInputValue();
                document.getElementById("pre-scale").value = MACHINE.partsPerBeatToInputValue();
                document.getElementById("instrument-select").value = INSTRUMENT_CONTROLLER.currentInstrumentIndex;
                document.getElementById("instrument-select").dispatchEvent(new Event("change"));
            }

            setUpMachine()
            /*still havent decided whether
                a) it should be the machine feeding the default values to the UI, or the opposite
                b) whether the machine object should save the input values or the true data
            */


        </script>
    </body>
</html>